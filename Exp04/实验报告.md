# 实验报告

## 三、实验过程或算法

### 1. 软件功能

本系统是一个基于 Web 的学生成绩管理系统，分为学生端和教师端，并集成了 AI 辅助功能。

**功能组织图：**

*   **系统入口**
    *   登录
    *   注册（学生/教师）
*   **学生端**
    *   **成绩查询**：查看各科成绩、绩点、平均分。
    *   **选课管理**：
        *   选课大厅：浏览可选课程，进行选课。
        *   选课中心：查看已选课程，退课。
    *   **AI 学业顾问**：基于成绩数据的智能问答。
    *   **个人中心**：查看和修改个人信息。
*   **教师端**
    *   **班级管理**：查看教学班列表。
    *   **成绩管理**：
        *   在线录入/修改成绩（平时、期中、实验、期末）。
        *   批量保存成绩。
        *   查看班级成绩统计（及格率、优秀率等）。
    *   **AI 教学分析**：针对班级成绩进行智能分析。
    *   **个人中心**：查看和修改个人信息。

### 2. 创新点或特色

1.  **AI 深度集成**：引入 LangChain4j 框架接入大语言模型（通义千问），实现了基于真实业务数据的 AI 咨询功能。
    *   学生可以询问 AI "我哪门课考得最差？"、"如何提高 Java 成绩？"，AI 会读取学生的实际成绩数据进行个性化回答。
    *   教师可以让 AI 分析某个班级的成绩分布，提供教学改进建议。
2.  **流式响应 (SSE)**：AI 对话采用 Server-Sent Events (SSE) 技术，实现了打字机效果的流式输出，提升了用户体验。
3.  **前后端分离架构**：虽然部署在同一个 Spring Boot 应用中，但前端采用纯 HTML/JS 调用 RESTful API 的方式，实现了逻辑上的分离。

### 3. 总体设计思想

采用经典的 **MVC (Model-View-Controller)** 设计模式和 **分层架构**。
*   **Controller 层**：处理 HTTP 请求，参数校验，返回统一格式的 JSON 响应。
*   **Service 层**：处理业务逻辑（如选课冲突检测、成绩计算、AI 上下文构建）。
*   **Mapper (DAO) 层**：使用 MyBatis 进行数据库交互。
*   **Entity/DTO/VO**：分别对应数据库实体、数据传输对象、视图对象，实现数据模型的解耦。

### 4. 设计模式的使用

1.  **单例模式 (Singleton)**：Spring Bean 默认单例，如 Service 和 Controller。
2.  **策略模式 (Strategy)**：Spring Security 中的认证策略。
3.  **工厂模式 (Factory)**：MyBatis 的 `SqlSessionFactory`。
4.  **DTO/VO 模式**：用于不同层级间的数据传输，避免直接暴露数据库实体。

### 5. 程序的结构或者架构

**代码组织结构：**
```
com.cqu.exp04
├── config          // 配置类 (Security, LangChain4j)
├── controller      // 控制器 (API 接口)
├── dto             // 数据传输对象 (接收前端参数)
├── entity          // 数据库实体
├── exception       // 全局异常处理
├── mapper          // MyBatis Mapper 接口
├── security        // JWT 认证相关
├── service         // 业务逻辑接口及实现
└── vo              // 视图对象 (返回前端数据)
```

**部署架构：**
单体应用架构，Spring Boot 内置 Tomcat 容器，前端静态资源打包在 jar 包中，数据库使用 MySQL。

### 6. 程序主要执行流程图

*(此处建议插入流程图，例如：登录流程、选课流程)*

**登录流程简述：**
1. 用户提交用户名密码。
2. `AuthController` 接收请求。
3. `AuthService` 调用 `AuthenticationManager` 进行认证。
4. 认证成功生成 JWT Token。
5. 返回 Token 给前端，前端存储在 LocalStorage。

### 7. 前后端交互接口设计

采用 RESTful 风格 API，统一响应格式 `Result<T>`。

*   `POST /api/auth/login`: 登录
*   `GET /api/student/scores`: 获取成绩
*   `POST /api/student/enroll`: 选课
*   `POST /api/teacher/score/input`: 录入成绩
*   `GET /api/teacher/ai/consult/stream`: AI 流式咨询

### 8. 安全设计

1.  **JWT (JSON Web Token)**：实现无状态认证。每次请求在 Header 中携带 `Authorization: Bearer <token>`。
2.  **Spring Security**：配置安全过滤器链，对不同路径进行权限控制（如 `/api/student/**` 仅限学生访问）。
3.  **密码加密**：使用 `BCryptPasswordEncoder` 对用户密码进行哈希加密存储。

### 9. SpringBoot 的详细使用说明

*   **依赖管理**：使用 Maven 管理 `spring-boot-starter-web`, `mybatis-spring-boot-starter`, `spring-boot-starter-security` 等依赖。
*   **配置文件**：使用 `application.yaml` 配置端口、数据库连接、MyBatis 路径、日志级别等。
*   **自动配置**：利用 Spring Boot 的自动配置特性，简化了 MyBatis 和 Web MVC 的配置。

### 10. 实体类和数据库表的详细设计

主要实体包括：
*   `User`: 用户基类（账号、密码、角色）
*   `Student`: 学生信息
*   `Teacher`: 教师信息
*   `Course`: 课程信息
*   `TeachingClass`: 教学班（关联课程和教师）
*   `Enrollment`: 选课记录（关联学生和教学班）
*   `Score`: 成绩记录

### 11. 核心源代码及说明

*(请在此处粘贴关键代码片段，例如 `AIService` 的实现，或 `StudentController` 的选课逻辑)*

### 12. 人工智能应用情况

**使用了什么 AI：** 阿里云通义千问 (Qwen-Max) 大语言模型。

**如何使用 AI：**
通过 `langchain4j` 框架接入。在 `AIService` 中，系统会先查询数据库获取用户的相关数据（如学生的所有成绩、班级的所有学生成绩），将这些数据转化为自然语言描述，作为 "System Prompt" 或上下文注入到 LLM 中，从而让 AI 能够基于事实数据回答用户问题。

**完成了什么任务：**
1.  **学业诊断**：分析学生成绩短板。
2.  **教学建议**：分析班级整体表现，指出共性问题。

**使用 AI 的截图：**
*(此处请在运行项目后截图：学生端点击"AI 学业顾问"进行对话的界面，以及教师端"AI 教学分析"的界面)*

### 13. 其他需要论述和补充的内容

本项目移除了 Redis 依赖，简化了部署流程，专注于业务逻辑和 AI 应用的结合。

---

## 四、实验结果及分析

### 1. 源程序调试过程
*(此处填写调试过程中遇到的问题，例如：跨域问题如何解决、JWT Token 过期如何处理、AI 响应超时如何优化等)*

### 2. 实验总结与体会
*(必写：总结本次实验的收获，对 Spring Boot 开发流程的理解，对 AI 应用开发的感悟)*

